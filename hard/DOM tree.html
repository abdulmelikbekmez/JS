<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="icon" href="/JS/images/JS.png">
    <title>DOM Tree</title>
  <style>
    body  {
        max-width: 440px;
        background: honeydew;
    }
    details, li {
        margin: 0;
        margin-left: 1em;
    }
    details > summary {
        list-style: none;
        cursor: pointer;
        color: darkred;  
    }
    /* details[open] > summary { } */
    details > li {
        list-style: none;
        color: blue;
    }
    #output {
        color: green;
        line-height: 1.4;
    }
  </style>
</head>

<body>
<div id=main>
  <h2>Sample formatted text</h2>
  <hr>
  <blockquote><span>No book can ever be finished. While working on it we learn just enough to find it immature the moment we turn away from it.
    </span>
    <p>— <b>Karl Popper</b>, preface to the second editon of <i>The Open Society and Its Enemies</i>, 1950</p>
  </blockquote>
  <hr>
  <div><b>Sample code</b>
    <pre id=sample></pre>
  </div>
  <div>Ref: <a href="http://eloquentjavascript.net/14_dom.html#h_AlX6HES+2D">Creating nodes</a>
  </div>
  <hr>
</div>
  <input id=detailed type="checkbox"> Use <code>&lt;details&gt;</code>
  <p id=output></p>
<script>
"use strict";
const tree = [], SPACE = '&emsp;', MAX = 26;
function textOf(e) {
  let c = e.firstChild
  if (!c || c instanceof Element) c = ''
  else c = SPACE+c.textContent
  if (c.length>MAX+3) c = c.substring(0, MAX)+'…'
  return e.tagName+c
}
function toTree(e, space) {
  if (e.tagName === 'BR') return
  tree.push(space+'+ '+textOf(e))
  for (let c of e.children)
      toTree(c, space+SPACE)
}
function toDetails(e) {
  let detail = ''
  let num = 0  //e.childElementCount
  //skip <br> tags -- ignore them
  for (let c of e.children) {
    if (c.tagName === 'BR') continue
    detail += toDetails(c); num++ 
  }
  if (num === 0) //no children
    return '<li>'+textOf(e)+'</li>\n'
  let sum = e.tagName+SPACE+'[+'+num+']'
  return '<details id="'+textOf(e)+'" open>'
      +'<summary>'+sum+'</summary>'
      +detail+'</details>\n'
}
function toggle(evt) {
    let d = evt.target   //details
    let s = d.firstChild //summary
    let t = s.innerText  //swap
    s.innerText = d.id
    d.id = t
}
function render() {
  sample.innerText = textOf+'\n'+toTree+'\n'+toDetails
  if (detailed.checked) {
    output.innerHTML = toDetails(main)
    let da = output.querySelectorAll('details')
    for (let d of da) d.ontoggle = toggle
  } else {
    tree.length = 0; toTree(main, '')
    output.innerHTML = tree.join('<br>')
  }
}
detailed.onchange = render
render()
</script>
</body>
</html>