<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="icon" href="/JS/images/JS.png">
    <title>DOM Tree</title>
  <style>
    body  {
      background: honeydew;
      margin: 0;
      }
    small {
      font-weight: normal;
      font-size: 17px;
    }
    iframe {
      height: 99vh;
      border: none;
      background: white;
      margin: 0;
    }
    div {
      margin: 0 0 0 8px;
    }
    iframe, div {
      display: inline-block;
      box-sizing: border-box;
      vertical-align: top;
      max-height: 99vh;
      overflow-y: auto;
      width: 100%;
    }
@media screen and (min-width: 600px) {
  iframe { width: 53%; }
  div { width: 45%; }
}
    details, li {
        margin: 0;
        margin-left: 1em;
    }
    details > summary {
        list-style: none;
        cursor: pointer;
        color: darkred;  
    }
    /* details[open] > summary { } */
    details > li {
        list-style: none;
        color: blue;
    }
    #output {
        color: green;
        line-height: 1.4;
    }
  </style>
</head>

<body>
  <iframe id=frm src="/JS/"></iframe>
  <div>
    <h2><span id=title></span>
      <small>for the selected page</small>
    </h2>
    <input id=detailed type="checkbox">
    Use <code>&lt;details&gt;</code>
    <p id=output></p>
  </div>

<script>
"use strict";
const SPACE = '&emsp;', MAX = 32;
const SKIP = ['BR', 'SCRIPT'] //ignore these tags
function textOf(e) {
  let c = e.firstChild
  if (!c || c instanceof Element) c = ''
  else c = SPACE+c.textContent
  if (c.length>MAX+3) c = c.substring(0, MAX)+'â€¦'
  return e.tagName+c
}
function toTree(e, space) {
  let tree = space+'+ '+textOf(e)+'<br>\n'
  for (let c of e.children) {
    if (SKIP.includes(c.tagName)) continue
    tree += toTree(c, space+SPACE)
  }
  return tree
}
function toDetails(e, lev) {
  let detail = ''
  let num = 0  //e.childElementCount
  for (let c of e.children) {
    if (SKIP.includes(c.tagName)) continue
    detail += toDetails(c, lev+1); num++ 
  }
  if (num === 0) //no children
    return '<li>'+textOf(e)+'</li>\n'
  let sum = e.tagName+SPACE+'[+'+num+']'
  return '<details id="'+textOf(e)+'"'
      +(num>10 && lev>0 ? '' : ' open')
      +'><summary>'+sum+'</summary>'
      +detail+'</details>\n'
}
function toggle(evt) {
    let d = evt.target   //details
    let s = d.firstChild //summary
    let t = s.innerText  //swap
    s.innerText = d.id
    d.id = t
}
function render() {
  let main = frm.contentWindow.document.body
  if (detailed.checked) {
    output.innerHTML = toDetails(main, 0)
    let da = output.querySelectorAll('details')
    for (let d of da) d.ontoggle = toggle
  } else {
    output.innerHTML = toTree(main, '')
  }
}
title.innerText = document.title
detailed.onchange = render
frm.onload = render
</script>
</body>
</html>